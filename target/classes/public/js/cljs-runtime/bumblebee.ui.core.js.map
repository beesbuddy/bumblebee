{"version":3,"sources":["bumblebee/ui/core.cljs"],"mappings":"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","names":["bumblebee.ui.core/route->component","bumblebee.ui.chunks/Home","bumblebee.ui.chunks/About","bumblebee.ui.chunks/Admin","bumblebee.ui.chunks/Login","f__32256__auto__","js/goog.DEBUG","temp__5825__auto__","bumblebee.ui.core/app-root","f__32180__auto__","*current-component*-orig-val__38425","uix.core/*current-component*","*current-component*-temp-val__38426","uix.core/set-display-name","js/window","js/window.uix","js/window.uix.dev","sig__32189__auto__","js/window.uix.dev.signature!","js/window.uix.dev.register!","vec__38417","cljs.core.nth","vec__38420","route","set-route","cljs.core/deref","uix.core/use-state","bumblebee.ui.router/current","authed","set-authed","bumblebee.ui.auth/authed?","uix.hooks.alpha.use_effect","uix.hooks.alpha/use-clj-deps","bumblebee.ui.auth/load!","bumblebee.ui.router/start!","_","cljs.core/add-watch","v","bumblebee.ui.auth/state","G__38424","cljs.core/remove-watch","bumblebee.ui.router/stop!","name","cljs.core.get_in","requires-auth?","unauthorized?","cljs.core/not","Page","cljs.core.get","bumblebee.ui.auth/set-redirect!","bumblebee.ui.router/navigate!","js/undefined","uix.compiler.aot/>el","uix.compiler.aot/fragment","uix.compiler.attributes/interpret-attrs","uix.compiler.alpha/component-element","bumblebee.ui.components.navbar/navbar","js/bumblebee","js/bumblebee.ui","js/bumblebee.ui.core","js/bumblebee.ui.core.root*","bumblebee.ui.core/root*","cljs.core.atom","bumblebee.ui.core/ensure-root!","el","js/document.getElementById","js/console.log","cljs.core/reset!","uix.dom.create_root","bumblebee.ui.core/mount!","root","uix.dom/render-root","uix.core/strict-mode","bumblebee.ui.core/render","bumblebee.ui.core/init","e38427"],"sourcesContent":["(ns bumblebee.ui.core\n  (:require\n   [bumblebee.ui.auth :as auth]\n   [bumblebee.ui.chunks :as chunks]\n   [bumblebee.ui.components.navbar :as navbar]\n   [bumblebee.ui.components.spinner :as spinner]\n   [bumblebee.ui.router :as router]\n   [\"react\" :as react]\n   [uix.core :refer [$ defui] :as uix]\n   [uix.dom :as dom]\n   [uix.preload]))\n\n(def route->component\n  {:home chunks/Home\n   :about chunks/About\n   :admin chunks/Admin\n   :login chunks/Login})\n\n(defui app-root []\n  (let [[route set-route] (uix.core/use-state @router/current)\n        [authed set-authed] (uix.core/use-state (auth/authed?))]\n    (uix.core/use-effect\n      (fn []\n        (auth/load!)\n        (router/start!)\n        (let [_ (add-watch router/current ::root (fn [_ _ _ v] (set-route v)))\n              _ (add-watch auth/state ::auth (fn [_ _ _ _] (set-authed (auth/authed?))))]\n          (fn []\n            (remove-watch router/current ::root)\n            (remove-watch auth/state ::auth)\n            (router/stop!))))\n      [])\n    (let [name (get-in route [:data :name])\n          requires-auth? (true? (get-in route [:data :requires-auth]))\n          unauthorized? (and requires-auth? (not authed))\n          Page (get route->component name chunks/Home)]\n      (uix.core/use-effect\n        (fn []\n          (when unauthorized?\n            (auth/set-redirect! {:name name\n                                 :params (:path-params route)\n                                 :query (:query-params route)})\n            (router/navigate! :login))\n          js/undefined)\n        [route unauthorized? name])\n      ($ :<>\n         ($ navbar/navbar)\n         ($ :main {:className \"container py-6\"}\n            ($ Page))))))\n\n(defonce root* (atom nil))\n\n(defn- ensure-root! []\n  (when (nil? @root*)\n    (when-let [el (js/document.getElementById \"app\")]\n      (js/console.log \"[ui] creating root @ #app\")\n      (reset! root* (uix.dom/create-root el))))\n  @root*)\n\n\n(defn mount! []\n  (when-let [root (ensure-root!)]\n    (js/console.log \"[ui] mount! rendering\")\n    (uix.dom/render-root\n     ($ uix/strict-mode\n        ($ app-root))\n     root)))\n\n(defn render []\n  (mount!))\n\n\n(defn ^:export init []\n  (js/console.log \"[ui] init called\")\n  (router/start!)\n  (render))\n\n;; Ensure initial mount even if :init-fn hook isn't triggered.\n(try\n  (init)\n  (catch :default _))\n"]}